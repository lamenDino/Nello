{
  "main.py": "import os\nfrom fastapi import FastAPI, HTTPException\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom fastapi.responses import JSONResponse\nimport yt_dlp\nimport requests\nimport re\nfrom typing import Optional\nimport logging\n\n# Setup logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\napp = FastAPI(title=\"Social Media Downloader API\", version=\"2.0\")\n\n# CORS configuration\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n\nclass SocialMediaDownloader:\n    def __init__(self):\n        # Get cookies file path\n        self.cookies_file = os.path.join(os.path.dirname(__file__), 'instagram_cookies.txt')\n\n        self.ydl_opts_instagram = {\n            'format': 'best',\n            'outtmpl': 'downloads/%(title)s.%(ext)s',\n            'quiet': False,\n            'no_warnings': False,\n            'socket_timeout': 30,\n            'cookiefile': self.cookies_file if os.path.exists(self.cookies_file) else None,\n        }\n\n        self.ydl_opts_facebook = {\n            'format': 'best',\n            'outtmpl': 'downloads/%(title)s.%(ext)s',\n            'quiet': False,\n            'no_warnings': False,\n            'socket_timeout': 30,\n        }\n\n        self.ydl_opts_default = {\n            'format': 'best',\n            'outtmpl': 'downloads/%(title)s.%(ext)s',\n            'quiet': False,\n            'no_warnings': False,\n            'socket_timeout': 30,\n        }\n\n    def fix_facebook_url(self, url: str) -> str:\n        \"\"\"Converte URL Facebook problematici in formato compatibile\"\"\"\n        if '/share/' in url:\n            try:\n                # Segui i redirect per ottenere l'URL reale\n                response = requests.head(\n                    url,\n                    allow_redirects=True,\n                    timeout=10,\n                    headers={'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'}\n                )\n                final_url = response.url\n                logger.info(f\"Facebook URL redirect: {url} -> {final_url}\")\n\n                # Estrai ID del video\n                match = re.search(r'[?&]v=(\\d+)', final_url)\n                if match:\n                    return f'https://www.facebook.com/watch/?v={match.group(1)}'\n\n                # Estrai formato reel\n                match = re.search(r'/reel/(\\d+)', final_url)\n                if match:\n                    return f'https://www.facebook.com/reel/{match.group(1)}'\n\n                return final_url\n            except Exception as e:\n                logger.error(f\"Errore conversione URL Facebook: {e}\")\n                return url\n        return url\n\n    def download(self, url: str) -> dict:\n        \"\"\"Download universale da social media\"\"\"\n        try:\n            # Validazione URL\n            if not url.startswith(('http://', 'https://')):\n                raise ValueError(\"URL deve iniziare con http:// o https://\")\n\n            # Determina la piattaforma\n            if 'instagram.com' in url:\n                logger.info(f\"Rilevato Instagram: {url}\")\n                opts = self.ydl_opts_instagram.copy()\n                if not os.path.exists(self.cookies_file):\n                    raise ValueError(\"Cookies Instagram non trovati. Contatta l'amministratore.\")\n            elif 'facebook.com' in url or 'fb.watch' in url:\n                logger.info(f\"Rilevato Facebook: {url}\")\n                url = self.fix_facebook_url(url)\n                opts = self.ydl_opts_facebook.copy()\n            elif 'tiktok.com' in url:\n                logger.info(f\"Rilevato TikTok: {url}\")\n                opts = self.ydl_opts_default.copy()\n            elif 'youtube.com' in url or 'youtu.be' in url:\n                logger.info(f\"Rilevato YouTube: {url}\")\n                opts = self.ydl_opts_default.copy()\n            else:\n                logger.info(f\"URL generico: {url}\")\n                opts = self.ydl_opts_default.copy()\n\n            # Download\n            with yt_dlp.YoutubeDL(opts) as ydl:\n                info = ydl.extract_info(url, download=True)\n\n                return {\n                    'success': True,\n                    'title': info.get('title', 'Unknown'),\n                    'url': url,\n                    'filename': ydl.prepare_filename(info),\n                    'duration': info.get('duration', 0),\n                    'uploader': info.get('uploader', 'Unknown'),\n                }\n\n        except Exception as e:\n            logger.error(f\"Errore download: {str(e)}\")\n            return {\n                'success': False,\n                'error': str(e),\n                'url': url,\n            }\n\n\n# Initialize downloader\ndownloader = SocialMediaDownloader()\n\n# Create downloads directory\nos.makedirs('downloads', exist_ok=True)\n\n\n@app.get(\"/\")\nasync def root():\n    \"\"\"Root endpoint - API info\"\"\"\n    return {\n        \"name\": \"Social Media Downloader API\",\n        \"version\": \"2.0\",\n        \"endpoints\": {\n            \"download\": \"/download?url=YOUR_URL\",\n            \"status\": \"/status\",\n            \"health\": \"/health\",\n        }\n    }\n\n\n@app.get(\"/download\")\nasync def download(url: str):\n    \"\"\"Download endpoint\"\"\"\n    if not url:\n        raise HTTPException(status_code=400, detail=\"URL parameter required\")\n\n    logger.info(f\"Download request: {url}\")\n    result = downloader.download(url)\n\n    if result['success']:\n        return JSONResponse(status_code=200, content=result)\n    else:\n        raise HTTPException(status_code=400, detail=result['error'])\n\n\n@app.post(\"/download\")\nasync def download_post(data: dict):\n    \"\"\"Download endpoint - POST method\"\"\"\n    url = data.get('url')\n\n    if not url:\n        raise HTTPException(status_code=400, detail=\"URL parameter required\")\n\n    logger.info(f\"Download request (POST): {url}\")\n    result = downloader.download(url)\n\n    if result['success']:\n        return JSONResponse(status_code=200, content=result)\n    else:\n        raise HTTPException(status_code=400, detail=result['error'])\n\n\n@app.get(\"/health\")\nasync def health():\n    \"\"\"Health check endpoint\"\"\"\n    return {\"status\": \"ok\", \"service\": \"Social Media Downloader\"}\n\n\n@app.get(\"/status\")\nasync def status():\n    \"\"\"Status endpoint\"\"\"\n    cookies_exists = os.path.exists(downloader.cookies_file)\n    downloads_dir_size = sum(os.path.getsize(os.path.join('downloads', f)) \n                            for f in os.listdir('downloads') \n                            if os.path.isfile(os.path.join('downloads', f))) // (1024*1024)\n\n    return {\n        \"status\": \"running\",\n        \"instagram_cookies\": \"configured\" if cookies_exists else \"missing\",\n        \"downloads_dir_size_mb\": downloads_dir_size,\n        \"supported_platforms\": [\"Instagram\", \"Facebook\", \"TikTok\", \"YouTube\", \"Twitter\", \"Reddit\"],\n    }\n\n\nif __name__ == \"__main__\":\n    import uvicorn\n    port = int(os.environ.get(\"PORT\", 8000))\n    uvicorn.run(app, host=\"0.0.0.0\", port=port)\n",
  "requirements.txt": "yt-dlp>=2025.11.0\nfastapi>=0.104.0\nuvicorn>=0.24.0\nrequests>=2.31.0\npython-multipart>=0.0.6\n",
  "render.yaml": "services:\n  - type: web\n    name: social-media-downloader\n    env: python\n    plan: free\n    buildCommand: \"pip install -r requirements.txt\"\n    startCommand: \"gunicorn -w 4 -k uvicorn.workers.UvicornWorker main:app --bind 0.0.0.0:$PORT\"\n    envVars:\n      - key: PYTHONUNBUFFERED\n        value: 1\n      - key: PORT\n        value: 8000\n",
  ".gitignore": "# Python\n__pycache__/\n*.py[cod]\n*$py.class\n*.so\n.Python\nenv/\nvenv/\nENV/\nbuild/\ndevelop-eggs/\ndist/\ndownloads/\n*.egg-info/\n.eggs/\nlib/\nlib64/\nparts/\nsdist/\nvar/\nwheels/\n*.egg-info/\n.installed.cfg\n*.egg\n\n# IDE\n.vscode/\n.idea/\n*.swp\n*.swo\n*~\n.DS_Store\n\n# Sensitive data\n*.txt\n!README.txt\n.env\n.env.local\ninstagram_cookies.txt\ncookies.txt\n\n# Application\n*.log\n.tmp/\ntemp/\n",
  "README.md": "# Social Media Downloader API\n\nUna API FastAPI per il download di video e contenuti da Instagram, Facebook, TikTok, YouTube e altri social media.\n\n## Caratteristiche\n\n✅ **Instagram** - Download di reels, post, storie (con autenticazione)\n✅ **Facebook** - Download di video, reels e contenuti (incluso formato /share/)\n✅ **TikTok** - Download di video\n✅ **YouTube** - Download di video\n✅ **Twitter/X** - Download di video\n✅ **Reddit** - Download di video e GIF\n\n## Installazione\n\n### Locale\n\n```bash\n# Clone repository\ngit clone https://github.com/your-username/social-media-downloader.git\ncd social-media-downloader\n\n# Crea virtual environment\npython -m venv venv\nsource venv/bin/activate  # Linux/Mac\n# o\nvenv\\Scripts\\activate  # Windows\n\n# Installa dipendenze\npip install -r requirements.txt\n\n# Esegui l'app\npython main.py\n```\n\nL'API sarà disponibile su `http://localhost:8000`\n\n### Su Render\n\n1. Crea un account su [Render.com](https://render.com)\n2. Connetti il tuo repository GitHub\n3. Crea un nuovo Web Service\n4. Seleziona \"Python\" come runtime\n5. Build command: `pip install -r requirements.txt`\n6. Start command: `gunicorn -w 4 -k uvicorn.workers.UvicornWorker main:app --bind 0.0.0.0:$PORT`\n\n## Configurazione Instagram\n\nPer scaricare da Instagram, hai bisogno dei cookies di autenticazione:\n\n1. Installa l'estensione \"Get cookies.txt LOCALLY\" nel tuo browser\n2. Accedi a Instagram\n3. Visita https://www.instagram.com\n4. Esporta i cookies in formato Netscape\n5. Salva il file come `instagram_cookies.txt` nella root del progetto\n\n**IMPORTANTE**: Non condividere mai i tuoi cookies online! Trattali come una password.\n\n## Utilizzo\n\n### GET Request\n\n```bash\ncurl \"http://localhost:8000/download?url=https://www.instagram.com/reel/xxxxx/\"\n```\n\n### POST Request\n\n```bash\ncurl -X POST http://localhost:8000/download \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"url\": \"https://www.facebook.com/watch/?v=xxxxx\"}'\n```\n\n### Response di successo\n\n```json\n{\n  \"success\": true,\n  \"title\": \"Video Title\",\n  \"url\": \"https://...\",\n  \"filename\": \"Video Title.mp4\",\n  \"duration\": 120,\n  \"uploader\": \"Username\"\n}\n```\n\n### Response di errore\n\n```json\n{\n  \"success\": false,\n  \"error\": \"Error message\",\n  \"url\": \"https://...\"\n}\n```\n\n## Endpoint\n\n- `GET /` - Info API\n- `GET /download?url=URL` - Download (GET method)\n- `POST /download` - Download (POST method)\n- `GET /health` - Health check\n- `GET /status` - Status e informazioni\n\n## Troubleshooting\n\n### \"Cookies Instagram non trovati\"\nAssicurati che il file `instagram_cookies.txt` sia nella root del progetto e contenga cookie validi.\n\n### \"ERROR: URL not supported\"\nVerifica che l'URL sia corretto e nella lista di piattaforme supportate.\n\n### \"Sign in required\"\nI tuoi cookies Instagram sono scaduti. Esporta nuovi cookies.\n\n### Facebook Reels /share/ non funzionano\nL'app converte automaticamente gli URL `/share/` nel formato corretto. Se continua a non funzionare, prova con l'URL diretto.\n\n## Licenza\n\nMIT License - Vedi LICENSE file\n\n## Supporto\n\nPer bug e feature requests, apri una issue su GitHub.\n\n## Disclaimer\n\nQuesto tool è solo per scopi educativi e personali. Assicurati di rispettare i termini di servizio delle piattaforme utilizzate e i diritti d'autore dei contenuti scaricati.\n",
  "Procfile": "web: gunicorn -w 4 -k uvicorn.workers.UvicornWorker main:app --bind 0.0.0.0:$PORT\n",
  "runtime.txt": "python-3.11.7\n",
  "docker-compose.yml": "version: '3.8'\n\nservices:\n  app:\n    build: .\n    ports:\n      - \"8000:8000\"\n    volumes:\n      - ./downloads:/app/downloads\n    environment:\n      - PORT=8000\n      - PYTHONUNBUFFERED=1\n    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload\n",
  "Dockerfile": "FROM python:3.11-slim\n\nWORKDIR /app\n\n# Installa dipendenze di sistema\nRUN apt-get update && apt-get install -y \\\n    ffmpeg \\\n    wget \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Copia requirements e installa dipendenze Python\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\n# Copia il codice dell'app\nCOPY . .\n\n# Crea directory per downloads\nRUN mkdir -p downloads\n\n# Esponi porta\nEXPOSE 8000\n\n# Start command\nCMD [\"uvicorn\", \"main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\"]\n",
  ".env.example": "# Social Media Downloader Configuration\nPORT=8000\nPYTHONUNBUFFERED=1\n\n# Instagram Cookies Path (relativo)\nINSTAGRAM_COOKIES=instagram_cookies.txt\n"
}